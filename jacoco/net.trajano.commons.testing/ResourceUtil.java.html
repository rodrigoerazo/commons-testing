<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ResourceUtil.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Commons Testing</a> &gt; <a href="index.source.html" class="el_package">net.trajano.commons.testing</a> &gt; <span class="el_source">ResourceUtil.java</span></div><h1>ResourceUtil.java</h1><pre class="source lang-java linenums">package net.trajano.commons.testing;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.UnsupportedEncodingException;

/**
 * Provides a utility class to load up resource streams.
 *
 * @author Archimedes Trajano
 */
public final class ResourceUtil {

    /**
     * Reads a resource as bytes from the the given class' class loader.
     *
     * @param clazz
     *            class
     * @param name
     *            name of the resource
     * @return input stream
     */
    public static byte[] getResourceAsBytes(final Class&lt;?&gt; clazz,
            final String name) {

<span class="pc" id="L29">        try (InputStream is = getResourceAsStream(clazz, name)) {</span>
<span class="fc" id="L30">            return streamToBytes(is);</span>
<span class="pc bpc" id="L31" title="6 of 8 branches missed.">        } catch (final IOException e) {</span>
<span class="nc" id="L32">            throw new AssertionError(e.getMessage(), e);</span>
        }
    }

    /**
     * Reads a resource as bytes from the context class loader.
     *
     * @param name
     *            name of the resource
     * @return input stream
     */
    public static byte[] getResourceAsBytes(final String name) {

<span class="pc" id="L45">        try (InputStream is = getResourceAsStream(name)) {</span>
<span class="fc" id="L46">            return streamToBytes(is);</span>
<span class="pc bpc" id="L47" title="6 of 8 branches missed.">        } catch (final IOException e) {</span>
<span class="nc" id="L48">            throw new AssertionError(e.getMessage(), e);</span>
        }
    }

    /**
     * Reads a resource as a stream from the the given class' class loader.
     * Callers are expected to close the resource after.
     *
     * @param clazz
     *            class
     * @param name
     *            name of the resource
     * @return input stream
     */
    public static InputStream getResourceAsStream(final Class&lt;?&gt; clazz,
            final String name) {

<span class="fc" id="L65">        final InputStream is = clazz.getResourceAsStream(name);</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">        if (is == null) {</span>
<span class="fc" id="L67">            throw new AssertionError(String.format(&quot;Unable to locate resource %s in %s&quot;, name, clazz));</span>
        }
<span class="fc" id="L69">        return is;</span>
    }

    /**
     * Reads a resource as a stream from the context class loader. Callers are
     * expected to close the resource after.
     *
     * @param name
     *            name of the resource
     * @return input stream
     */
    public static InputStream getResourceAsStream(final String name) {

<span class="fc" id="L82">        final InputStream is = Thread.currentThread()</span>
                .getContextClassLoader()
                .getResourceAsStream(name);
<span class="fc bfc" id="L85" title="All 2 branches covered.">        if (is == null) {</span>
<span class="fc" id="L86">            throw new AssertionError(String.format(&quot;Unable to locate resource %s in context class loader&quot;, name));</span>
        }
<span class="fc" id="L88">        return is;</span>
    }

    /**
     * Reads a resource as a string from the the given class' class loader.
     * Callers are expected to close the resource after. The data is expected to
     * be UTF-8.
     *
     * @param clazz
     *            class
     * @param name
     *            name of the resource
     * @return input stream
     */
    public static String getResourceAsString(final Class&lt;?&gt; clazz,
            final String name) {

        try {
<span class="fc" id="L106">            return new String(getResourceAsBytes(clazz, name), &quot;UTF-8&quot;);</span>
<span class="nc" id="L107">        } catch (final UnsupportedEncodingException e) {</span>
<span class="nc" id="L108">            throw new AssertionError(e.getMessage(), e);</span>
        }
    }

    /**
     * Reads a resource as a String from the from the context class loader.
     * Callers are expected to close the resource after.
     *
     * @param name
     *            name of the resource
     * @return string
     */
    public static String getResourceAsString(final String name) {

        try {
<span class="fc" id="L123">            return new String(getResourceAsBytes(name), &quot;UTF-8&quot;);</span>
<span class="nc" id="L124">        } catch (final UnsupportedEncodingException e) {</span>
<span class="nc" id="L125">            throw new AssertionError(e.getMessage(), e);</span>
        }
    }

    /**
     * Creates a copy of the resource from the given class' class loader to a
     * temporary file. It is expected that the test will delete the file
     * afterwards.
     *
     * @param clazz
     *            class
     * @param name
     *            name of the resource
     * @return temporary file
     */
    public static File getResourceCopy(final Class&lt;?&gt; clazz,
            final String name) {

<span class="pc" id="L143">        try (InputStream is = getResourceAsStream(clazz, name)) {</span>
<span class="fc" id="L144">            return streamToTempFile(is);</span>
<span class="pc bpc" id="L145" title="6 of 8 branches missed.">        } catch (final IOException e) {</span>
<span class="nc" id="L146">            throw new AssertionError(e.getMessage(), e);</span>
        }
    }

    /**
     * Creates a copy of the resource from the context class loader to a
     * temporary file. It is expected that the test will delete the file
     * afterwards.
     *
     * @param name
     *            name of the resource
     * @return temporary file
     */
    public static File getResourceCopy(final String name) {

<span class="pc" id="L161">        try (InputStream is = getResourceAsStream(name)) {</span>
<span class="fc" id="L162">            return streamToTempFile(is);</span>
<span class="pc bpc" id="L163" title="6 of 8 branches missed.">        } catch (final IOException e) {</span>
<span class="nc" id="L164">            throw new AssertionError(e.getMessage(), e);</span>
        }
    }

    /**
     * Converts an {@link InputStream} to bytes. This will not throw an
     * {@link IOException} but wraps it in an {@link AssertionError}. This reads
     * the {@link InputStream} to end of file, but does not close it.
     *
     * @param is
     *            input stream
     * @return byte array.
     */
    public static byte[] streamToBytes(final InputStream is) {

        try {
<span class="fc" id="L180">            final ByteArrayOutputStream baos = new ByteArrayOutputStream();</span>
<span class="fc" id="L181">            int c = is.read();</span>
<span class="fc bfc" id="L182" title="All 2 branches covered.">            while (c != -1) {</span>
<span class="fc" id="L183">                baos.write(c);</span>
<span class="fc" id="L184">                c = is.read();</span>
            }
<span class="fc" id="L186">            baos.close();</span>
<span class="fc" id="L187">            return baos.toByteArray();</span>
<span class="fc" id="L188">        } catch (final IOException e) {</span>
<span class="fc" id="L189">            throw new AssertionError(e.getMessage(), e);</span>
        }
    }

    /**
     * Copies the contents of an {@link InputStream} to a temporary file. This
     * will not throw an {@link IOException} but wraps it in an
     * {@link AssertionError}. This reads the {@link InputStream} to end of
     * file, but does not close it.
     *
     * @param is
     *            input stream
     * @return temporary file.
     */
    public static File streamToTempFile(final InputStream is) {

        try {
<span class="fc" id="L206">            final File file = File.createTempFile(&quot;test&quot;, &quot;.tmp&quot;);</span>
<span class="fc" id="L207">            final FileOutputStream os = new FileOutputStream(file);</span>

<span class="fc" id="L209">            int c = is.read();</span>
<span class="fc bfc" id="L210" title="All 2 branches covered.">            while (c != -1) {</span>
<span class="fc" id="L211">                os.write(c);</span>
<span class="fc" id="L212">                c = is.read();</span>
            }
<span class="fc" id="L214">            os.close();</span>
<span class="fc" id="L215">            return file;</span>
<span class="nc" id="L216">        } catch (final IOException e) {</span>
<span class="nc" id="L217">            throw new AssertionError(e.getMessage(), e);</span>
        }
    }

    /**
     * Prevent instantiation of utility class.
     */
<span class="fc" id="L224">    private ResourceUtil() {</span>
<span class="fc" id="L225">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>